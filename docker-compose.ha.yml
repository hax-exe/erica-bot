# Docker Compose override for High Availability deployment
# Usage: docker compose -f docker-compose.yml -f docker-compose.ha.yml up -d

services:
  # Override the default bot service to be the primary
  bot:
    container_name: discord-bot-primary
    environment:
      - HA_ENABLED=true
      - HA_INSTANCE_ID=bot-primary
    ports:
      - "3002:3002"

  # Add a standby bot instance
  bot-standby:
    image: ghcr.io/haxkiana/multi-bot-discord/bot:latest
    container_name: discord-bot-standby
    restart: unless-stopped
    depends_on:
      postgres:
        condition: service_healthy
      lavalink:
        condition: service_healthy
      redis:
        condition: service_healthy
    ports:
      - "3003:3002" # Different external port for health checks
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgres://bot:${DB_PASSWORD}@postgres:5432/discord_bot
      - LAVALINK_HOST=lavalink
      - LAVALINK_PORT=2333
      - REDIS_URL=redis://redis:6379
      - HA_ENABLED=true
      - HA_INSTANCE_ID=bot-standby
    networks:
      - bot-network
